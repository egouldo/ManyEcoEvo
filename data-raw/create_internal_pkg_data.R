# ------- Create tibble of analysis IDs of analyses with collinear variables -------
library(here)
library(tidyverse)
library(usethis)
library(ManyEcoEvo) # todo switch to getting the tar_make object. Consider putting in tar_make

# ----- Load Expert Subset -----

expert_subset <- readr::read_csv(here::here(
  "data-raw",
  "metadata_and_key_data",
  "Good_Statistician_ResponseIds.csv"
)) %>%
  distinct()

expert_subset <- ManyEcoEvo::ManyEcoEvo$data %>%
  list_rbind() %>%
  select(response_id, TeamIdentifier) %>%
  distinct() %>%
  semi_join(expert_subset)

# ------- Create tibble of analysis IDs of analyses with highly collinear variables -------

collinearity_subset <-
  tibble::tribble(
    ~response_id, ~id_col, ~dataset,
    "R_DoCdsvLclGEF14Z", "Armadal-1-1-1", "blue tit",
    "R_eqzPwjXV6eOi2zv", "Babinda-1-1-1", "blue tit",
    "R_eqzPwjXV6eOi2zv", "Babinda-2-2-1", "blue tit",
    "R_2Tzp6JznvkvCY4h", "Barham-1-1-1", "blue tit",
    "R_2Tzp6JznvkvCY4h", "Barham-2-2-1", "blue tit",
    "R_126erjKKuN3IwSJ", "Bega-1-1-1", "blue tit",
    "R_126erjKKuN3IwSJ", "Bega-1-1-2", "blue tit",
    "R_126erjKKuN3IwSJ", "Bega-2-2-1", "blue tit",
    "R_126erjKKuN3IwSJ", "Bega-2-2-2", "blue tit",
    "R_210APF6gYFATf7Y", "Borde-1-1-1", "blue tit",
    "R_1dzfML4yheLxG0D", "Bruc-1-1-1", "blue tit",
    "R_3lMQ3NmmjrzpbM2", "Caigun-1-1-1", "blue tit",
    "R_3lMQ3NmmjrzpbM2", "Caigun-2-2-1", "blue tit",
    "R_3rIdpCqsQtsmgqT", "Adelong-1-1-1", "blue tit",
    "R_3rIdpCqsQtsmgqT", "Adelong-2-2-1", "blue tit",
  )

# ---- Make Parameter Tables for Standardising out-of-sample Predictions ----

# NOTE: relies on package being built after running `data-raw/osf_load_analyst_datasets.R`
# alternatively, devtools::load_all() is needed to access the fns to build `analysis_data_param_tables`
# devtools::load_all() #TODO

# TODO consider moving *_data creation into this script to avoid dependence on pkg before built..

analysis_data_param_tables <-
  bind_rows(
    make_param_table(ManyEcoEvo::blue_tit_data) %>%
      mutate(dataset = "blue tit"),
    make_param_table(ManyEcoEvo::euc_data) %>%
      mutate(dataset = "eucalyptus")
  )

# ------- create tibbles of analysis IDs for summarising many analysts study -----


effect_ids <- tibble::tribble(
  ~id_col,
  "Bega-2-2-1",
  "Bega-2-2-2",
  "Bega-1-1-1",
  "Bega-1-1-2",
  "Bell-2-2-1",
  "Berr-1-1-1",
  "Bruc-1-1-1",
  "Burr-1-1-2",
  "Burr-1-1-1",
  "Burr-2-2-2",
  "Burr-2-2-1",
  "Clar-2-2-1",
  "Clar-1-1-1",
  "Clev-1-1-1",
  "Alban-1-1-1",
  "Alban-2-2-1",
  "Appin-2-2-1",
  "Appin-1-1-1",
  "Appin-4-4-1",
  "Appin-3-3-1",
  "Aubur-3-3-1",
  "Aubur-2-2-1",
  "Avoca-1-1-1",
  "Bargo-1-1-1",
  "Bargo-3-3-1",
  "Bargo-2-2-1",
  "Bargo-4-4-1",
  "Berry-1-1-1",
  "Binda-2-2-2",
  "Binda-2-2-1",
  "Binda-1-1-1",
  "Binda-1-1-2",
  "Borde-1-1-1",
  "Bowen-4-3-1",
  "Bowen-4-3-2",
  "Bowen-3-1-1",
  "Bowen-3-1-2",
  "Bowen-2-2-1",
  "Bowen-2-2-2",
  "Bulli-1-1-2",
  "Bulli-1-2-2",
  "Bulli-1-1-1",
  "Bulli-1-2-1",
  "Albury-2-2-1",
  "Albury-1-1-1",
  "Alding-1-1-1",
  "Allora-1-1-1",
  "Aramac-1-1-1",
  "Aramac-1-1-2",
  "Ararat-2-2-1",
  "Ararat-3-3-1",
  "Ararat-1-1-1",
  "Ararat-1-1-2",
  "August-2-2-1",
  "August-1-1-1",
  "Avenel-1-2-1",
  "Avenel-2-1-1",
  "Avenel-2-1-2",
  "Bamaga-1-1-1",
  "Barham-1-1-1",
  "Barham-2-2-1",
  "Barmah-1-1-1",
  "Barmer-1-1-1",
  "Batlow-1-1-1",
  "Batlow-1-1-2",
  "Batlow-1-1-3",
  "Beltan-2-2-1",
  "Beltan-1-1-1",
  "Beulah-1-1-1",
  "Bilpin-1-1-1",
  "Blinma-1-1-1",
  "Boulia-1-1-2",
  "Boulia-1-1-1",
  "Bourke-1-1-1",
  "Bowral-2-2-1",
  "Bowral-1-1-1",
  "Bright-1-1-1",
  "Buchan-1-1-1",
  "Bunbur-1-1-1",
  "Burnie-1-1-1",
  "Byrock-1-1-1",
  "Byrock-2-2-1",
  "Caigun-2-2-1",
  "Caigun-1-1-1",
  "Cairns-1-1-1",
  "Camden-1-1-2",
  "Camden-1-1-1",
  "Cattai-2-2-2",
  "Cattai-2-2-1",
  "Cattai-1-1-2",
  "Cattai-1-1-1",
  "Adelong-2-2-1",
  "Adelong-1-1-1",
  "Angasto-1-1-2",
  "Angasto-3-3-2",
  "Angasto-1-1-1",
  "Angasto-3-3-1",
  "Angasto-2-2-2",
  "Angasto-4-4-2",
  "Angasto-2-2-1",
  "Angasto-4-4-1",
  "Antwerp-1-5-1",
  "Antwerp-1-5-2",
  "Araluen-1-1-1",
  "Araluen-2-2-1",
  "Arltung-4-4-1",
  "Arltung-2-2-1",
  "Arltung-3-3-1",
  "Ashford-1-1-1",
  "Babinda-2-2-1",
  "Babinda-1-1-1",
  "Ballina-1-1-1",
  "Bargara-1-1-1",
  "Barooga-2-2-1",
  "Barooga-1-1-1",
  "Barraba-1-1-1",
  "Belmont-1-1-1",
  "Bemboka-2-2-1",
  "Bemboka-1-1-1",
  "Benalla-1-1-1",
  "Benalla-1-1-2",
  "Benalla-2-2-1",
  "Benalla-2-2-2",
  "Bendigo-5-5-1",
  "Bendigo-2-2-1",
  "Bendigo-1-1-1",
  "Bendigo-4-4-1",
  "Berrima-1-1-1",
  "Berrima-2-2-1",
  "Berwick-2-2-1",
  "Beverle-1-1-1",
  "Birchip-1-1-1",
  "Bodalla-1-1-1",
  "Bombala-1-1-1",
  "Bonalbo-1-1-1",
  "Bonalbo-2-2-1",
  "Boorowa-1-1-1",
  "Boorowa-1-2-1",
  "Brookto-1-1-1",
  "Candelo-3-3-1",
  "Carcoar-1-1-1",
  "Aberdeen-1-1-1",
  "Andamook-3-3-1",
  "Andamook-1-1-1",
  "Andamook-4-4-1",
  "Andamook-2-2-1",
  "Byrock-1-3-1",
  "Byrock-5-7-1",
  "Byrock-4-6-1",
  "Byrock-2-4-1",
  "Byrock-3-5-1",
  "Anglesea-1-1-1",
  "Anglesea-2-2-1",
  "Ardrossa-1-1-1",
  "Atherton-3-3-1",
  "Atherton-1-1-1",
  "Atherton-2-2-1",
  "Ballarat-1-1-1",
  "Balmoral-1-1-1",
  "Bangalow-1-1-1",
  "Bangalow-2-2-1",
  "Bangalow-3-3-1",
  "Bathurst-1-1-1",
  "Beachpor-1-1-1",
  "Beachpor-1-1-2",
  "Beachpor-1-1-3",
  "Beachpor-2-2-1",
  "Beachpor-2-2-2",
  "Beachpor-2-2-3",
  "Belgrave-1-1-1",
  "Bencubbi-1-1-1",
  "Blackall-1-1-1",
  "Boggabri-1-1-1",
  "Booligal-3-3-1",
  "Booligal-2-2-1",
  "Booligal-4-4-1",
  "Booligal-5-5-1",
  "Boydtown-3-3-1",
  "Boydtown-1-1-1",
  "Boydtown-2-2-1",
  "Byrock-3-10-1",
  "Byrock-1-8-1",
  "Byrock-2-9-1",
  "Branxton-1-1-1",
  "Bridport-1-1-1",
  "Brighton-1-1-3",
  "Brighton-1-1-1",
  "Brighton-1-1-2",
  "Brooklyn-2-2-1",
  "Brooklyn-1-1-1",
  "Brooklyn-3-3-1",
  "Buckland-1-1-1",
  "Bundeena-1-6-1",
  "Busselto-1-1-1",
  "Calliope-3-3-1",
  "Calliope-4-4-1",
  "Canberra-1-1-1",
  "Capertee-1-1-1",
  "Capertee-2-2-1",
  "Carnarvo-1-1-1",
  "Bundeena-1-1-1",
  "Bundeena-2-2-1",
  "Bundeena-3-3-1",
  "Bundeena-4-4-1",
  "Bundeena-5-5-1",
  "Cassilis-1-1-1",
  "Cessnock-1-1-1",
  "Charlton-1-1-1",
  "Childers-1-1-1",
  "Childers-2-2-1"
)

prediction_ids <- tibble::tribble(
  ~id_col,
  "Bega-1-1-1",
  "Bega-2-2-1",
  "Bell-2-2-1",
  "Berr-1-1-1",
  "Burr-1-1-1",
  "Burr-2-2-1",
  "Alban-1-1-1",
  "Alban-2-2-1",
  "Avoca-1-1-1",
  "Berry-1-1-1",
  "Clev-1-1-1",
  "Aubur-2-2-1",
  "Aubur-3-3-1",
  "Binda-1-1-1",
  "Binda-2-2-1",
  "Borde-1-1-1",
  "Bowen-2-2-1",
  "Bowen-3-1-1",
  "Albury-1-1-1",
  "Albury-2-2-1",
  "Allora-1-1-1",
  "Aramac-1-1-1",
  "Ararat-1-1-1",
  "Ararat-2-2-1",
  "Ararat-3-3-1",
  "Avenel-1-2-1",
  "Bamaga-1-1-1",
  "August-1-1-1",
  "August-2-2-1",
  "Barmer-1-1-1",
  "Baxter-1-1-1",
  "Baxter-2-2-1",
  "Bethan-1-1-1",
  "Beulah-1-1-1",
  "Blinma-1-1-1",
  "Bowral-1-1-1",
  "Bowral-2-2-1",
  "Bunbur-1-1-1",
  "Burnie-1-1-1",
  "Cairns-1-1-1",
  "Byrock-1-1-1",
  "Byrock-2-2-1",
  "Caigun-1-1-1",
  "Caigun-2-2-1",
  "Cattai-1-1-1",
  "Cattai-2-2-1",
  "Angasto-1-1-1",
  "Angasto-3-3-1",
  "Antwerp-1-5-1",
  "Barooga-1-1-1",
  "Barooga-2-2-1",
  "Barraba-1-1-1",
  "Berrima-1-1-1",
  "Berrima-2-2-1",
  "Araluen-1-1-1",
  "Ashford-1-1-1",
  "Babinda-1-1-1",
  "Babinda-2-2-1",
  "Bemboka-1-1-1",
  "Bemboka-2-2-1",
  "Benalla-1-1-1",
  "Benalla-2-2-1",
  "Berwick-2-2-1",
  "Beverle-1-1-1",
  "Bodalla-1-1-1",
  "Broulee-1-1-1",
  "Bonalbo-1-1-1",
  "Carnama-1-1-1",
  "Andamook-1-1-1",
  "Andamook-2-2-1",
  "Andamook-3-3-1",
  "Andamook-4-4-1",
  "Byrock-2-4-1",
  "Byrock-3-5-1",
  "Byrock-4-6-1",
  "Anglesea-2-2-1",
  "Belgrave-1-1-1",
  "Byrock-1-8-1",
  "Byrock-2-9-1",
  "Byrock-3-10-1",
  "Branxton-1-1-1",
  "Boggabri-1-1-1",
  "Capertee-1-1-1",
  "Capertee-2-2-1",
  "Cassilis-1-1-1",
  "Childers-1-1-1",
  "Childers-2-2-1",
  "Cessnock-1-1-1"
) # TODO ask HF where/how derived (used data pasta to copy from HF's files)


# ------- Write data internally -------

usethis::use_data(expert_subset,
  analysis_data_param_tables,
  collinearity_subset,
  prediction_ids,
  effect_ids,
  internal = TRUE,
  overwrite = TRUE
)
